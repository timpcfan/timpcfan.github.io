<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta property="og:url" content="https://timpcfan.site/code/language/python/python-asyncio.html"><meta property="og:site_name" content="TrystanLei"><meta property="og:title" content="Pythonå¼‚æ­¥I/Oä¸åç¨‹"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-02T16:52:25.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Python"><meta property="article:tag" content="å¹¶å‘"><meta property="article:tag" content="å¼‚æ­¥IO"><meta property="article:tag" content="åç¨‹"><meta property="article:modified_time" content="2022-10-02T16:52:25.000Z"><title>Pythonå¼‚æ­¥I/Oä¸åç¨‹ | TrystanLei</title><meta name="description" content="ç§¯ç´¯ç‚¹æ»´ï¼Œæ±‡èšæˆæºªã€‚">
    <meta name="keywords" content="è‡ªæˆ‘æå‡,æ•ˆç‡æå‡,å¼€æºå·¥å…·,å­¦ä¹ ç¬”è®°" />
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.024ebb14.css">
    <link rel="modulepreload" href="/assets/app.905a1b95.js"><link rel="modulepreload" href="/assets/python-asyncio.html.cb0b0334.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/python-asyncio.html.a8ede0a0.js">
    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://timpcfansite.matomo.cloud/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='//cdn.matomo.cloud/timpcfansite.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->

  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/avatar_self.webp" alt="TrystanLei"><!----><span class="site-name hide-in-pad">TrystanLei</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/" class="nav-link" aria-label="éšç¬”"><span class="icon iconfont icon-note"></span>éšç¬”<!----></a></div><div class="nav-item hide-in-mobile"><a href="/life/" class="nav-link" aria-label="ç”Ÿæ´»"><span class="icon iconfont icon-flower"></span>ç”Ÿæ´»<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å­¦ä¹ ç¬”è®°"><span class="title"><span class="icon iconfont icon-edit"></span>å­¦ä¹ ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¼€å‘ç¬”è®°</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/code/" class="nav-link" aria-label="å¼€å‘ç¬”è®°"><span class="icon iconfont icon-code"></span>å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-subitem"><a href="/code/language/" class="nav-link" aria-label="ç¼–ç¨‹è¯­è¨€"><span class="icon iconfont icon-language"></span>ç¼–ç¨‹è¯­è¨€<!----></a></li><li class="dropdown-subitem"><a href="/code/frontend/" class="nav-link" aria-label="å‰ç«¯å¼€å‘"><span class="icon iconfont icon-template"></span>å‰ç«¯å¼€å‘<!----></a></li><li class="dropdown-subitem"><a href="/code/backend/" class="nav-link" aria-label="åç«¯å¼€å‘"><span class="icon iconfont icon-module"></span>åç«¯å¼€å‘<!----></a></li><li class="dropdown-subitem"><a href="/code/system-design/" class="nav-link" aria-label="ç³»ç»Ÿè®¾è®¡"><span class="icon iconfont icon-structure"></span>ç³»ç»Ÿè®¾è®¡<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ç®—æ³•ç¬”è®°</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algo/" class="nav-link" aria-label="ç®—æ³•ç¬”è®°"><span class="icon iconfont icon-rank"></span>ç®—æ³•ç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ‚é¡¹"><span class="title"><span class="icon iconfont icon-any"></span>æ‚é¡¹</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/random/freq_urls.html" class="nav-link" aria-label="å¸¸ç”¨é“¾æ¥"><span class="icon iconfont icon-link"></span>å¸¸ç”¨é“¾æ¥<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><a class="repo-link" href="https://github.com/timpcfan/timpcfan.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/code/language/" class="nav-link sidebar-link sidebar-page" aria-label="ç¼–ç¨‹è¯­è¨€"><span class="icon iconfont icon-code"></span>ç¼–ç¨‹è¯­è¨€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-java"></span><span class="title">Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-javascript"></span><span class="title">JavaScript</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-python"></span><span class="title">Python</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/code/language/python/" class="nav-link sidebar-link sidebar-page" aria-label="Python"><span class="icon iconfont icon-python"></span>Python<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-data-structures.html" class="nav-link sidebar-link sidebar-page" aria-label="Pythonå¸¸ç”¨æ•°æ®ç»“æ„"><!---->Pythonå¸¸ç”¨æ•°æ®ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="Pythonæ’åº - sort"><!---->Pythonæ’åº - sort<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-bisect.html" class="nav-link sidebar-link sidebar-page" aria-label="PythonäºŒåˆ†æŸ¥æ‰¾ - bisect"><!---->PythonäºŒåˆ†æŸ¥æ‰¾ - bisect<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-ordchr.html" class="nav-link sidebar-link sidebar-page" aria-label="Pythonå­—ç¬¦æ•°å­—ä¹‹é—´çš„è½¬æ¢å‡½æ•°"><!---->Pythonå­—ç¬¦æ•°å­—ä¹‹é—´çš„è½¬æ¢å‡½æ•°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-log.html" class="nav-link sidebar-link sidebar-page" aria-label="Pythonæ—¥å¿— - logging"><!---->Pythonæ—¥å¿— - logging<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/code/language/python/python-concurrent.html" class="nav-link sidebar-link sidebar-page" aria-label="Pythonå¹¶å‘ç¼–ç¨‹"><!---->Pythonå¹¶å‘ç¼–ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/code/language/python/python-asyncio.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Pythonå¼‚æ­¥I/Oä¸åç¨‹"><!---->Pythonå¼‚æ­¥I/Oä¸åç¨‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#asyncio-â€”-å¼‚æ­¥-i-o-åç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="asyncio â€” å¼‚æ­¥ I/O &amp; åç¨‹"><!---->asyncio â€” å¼‚æ­¥ I/O &amp; åç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹ä¸ä»»åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åç¨‹ä¸ä»»åŠ¡"><!---->åç¨‹ä¸ä»»åŠ¡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åç¨‹"><!---->åç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¯ç­‰å¾…å¯¹è±¡-awaitable-objects" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¯ç­‰å¾…å¯¹è±¡ awaitable objects"><!---->å¯ç­‰å¾…å¯¹è±¡ awaitable objects<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åç¨‹"><!---->åç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä»»åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»»åŠ¡"><!---->ä»»åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#futures" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Futures"><!---->Futures<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#è¿è¡Œ-asyncio-ç¨‹åº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¿è¡Œ asyncio ç¨‹åº"><!---->è¿è¡Œ asyncio ç¨‹åº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åˆ›å»ºä»»åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ›å»ºä»»åŠ¡"><!---->åˆ›å»ºä»»åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¼‘çœ " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¼‘çœ "><!---->ä¼‘çœ <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¹¶å‘è¿è¡Œä»»åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¹¶å‘è¿è¡Œä»»åŠ¡"><!---->å¹¶å‘è¿è¡Œä»»åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å±è”½å–æ¶ˆæ“ä½œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å±è”½å–æ¶ˆæ“ä½œ"><!---->å±è”½å–æ¶ˆæ“ä½œ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#è¶…æ—¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¶…æ—¶"><!---->è¶…æ—¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ç®€å•ç­‰å¾…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç®€å•ç­‰å¾…"><!---->ç®€å•ç­‰å¾…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åœ¨çº¿ç¨‹ä¸­è¿è¡Œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åœ¨çº¿ç¨‹ä¸­è¿è¡Œ"><!---->åœ¨çº¿ç¨‹ä¸­è¿è¡Œ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#è·¨çº¿ç¨‹è°ƒåº¦" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·¨çº¿ç¨‹è°ƒåº¦"><!---->è·¨çº¿ç¨‹è°ƒåº¦<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å†…çœ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å†…çœ"><!---->å†…çœ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#task-å¯¹è±¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Task å¯¹è±¡"><!---->Task å¯¹è±¡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#stream-æµ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Stream æµ"><!---->Stream æµ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#stream-å‡½æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Stream å‡½æ•°"><!---->Stream å‡½æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#unix-å¥—æ¥å­—-socket" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Unix å¥—æ¥å­—ï¼ˆSocketï¼‰"><!---->Unix å¥—æ¥å­—ï¼ˆSocketï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#streamreader-ä¸-streamwriter" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="StreamReader ä¸ StreamWriter"><!---->StreamReader ä¸ StreamWriter<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¾‹å­-echo-æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¾‹å­ï¼šecho æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯"><!---->ä¾‹å­ï¼šecho æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åŒæ­¥åŸè¯­" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŒæ­¥åŸè¯­"><!---->åŒæ­¥åŸè¯­<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#lock" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Lock"><!---->Lock<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#event" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Event"><!---->Event<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#condition" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Condition"><!---->Condition<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#semaphore" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Semaphore"><!---->Semaphore<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#boundedsemaphore" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="BoundedSemaphore"><!---->BoundedSemaphore<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#é˜Ÿåˆ—é›†åˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é˜Ÿåˆ—é›†åˆ"><!---->é˜Ÿåˆ—é›†åˆ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#queue" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Queue"><!---->Queue<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¼˜å…ˆçº§é˜Ÿåˆ—"><!---->ä¼˜å…ˆçº§é˜Ÿåˆ—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åè¿›å…ˆå‡ºé˜Ÿåˆ—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åè¿›å…ˆå‡ºé˜Ÿåˆ—"><!---->åè¿›å…ˆå‡ºé˜Ÿåˆ—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¾‹å­" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¾‹å­"><!---->ä¾‹å­<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#äº‹ä»¶å¾ªç¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº‹ä»¶å¾ªç¯"><!---->äº‹ä»¶å¾ªç¯<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å‰è¨€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‰è¨€"><!---->å‰è¨€<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#é«˜å±‚çº§-api-ç´¢å¼•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é«˜å±‚çº§ API ç´¢å¼•"><!---->é«˜å±‚çº§ API ç´¢å¼•<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä»»åŠ¡-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»»åŠ¡"><!---->ä»»åŠ¡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#é˜Ÿåˆ—é›†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é˜Ÿåˆ—é›†"><!---->é˜Ÿåˆ—é›†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å­è¿›ç¨‹é›†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å­è¿›ç¨‹é›†"><!---->å­è¿›ç¨‹é›†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#æµ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æµ"><!---->æµ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#åŒæ­¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŒæ­¥"><!---->åŒæ­¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¼‚å¸¸" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚å¸¸"><!---->å¼‚å¸¸<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/code/language/python/python-asyncio.html#å…³äº-never-awaited-åç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…³äº never-awaited åç¨‹"><!---->å…³äº never-awaited åç¨‹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Pythonå¼‚æ­¥I/Oä¸åç¨‹</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://timpcfan.site" target="_blank" rel="noopener noreferrer">TrystanLei</a></span><span property="author" content="TrystanLei"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´10æœˆ2æ—¥</span><meta property="datePublished" content="2022-10-02T16:52:25.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category8 clickable" role="navigation">ç¬”è®°</li><li class="category category3 clickable" role="navigation">API</li><meta property="articleSection" content="ç¬”è®°,API"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag2 clickable" role="navigation">Python</li><li class="tag tag6 clickable" role="navigation">å¹¶å‘</li><li class="tag tag2 clickable" role="navigation">å¼‚æ­¥IO</li><li class="tag tag1 clickable" role="navigation">åç¨‹</li></ul><meta property="keywords" content="Python,å¹¶å‘,å¼‚æ­¥IO,åç¨‹"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 6956 å­—</span><meta property="wordCount" content="6956"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span><span class="visitor-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="down" localizeddate="2022å¹´10æœˆ2æ—¥" isoriginal="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span class="waline-pageview-count" data-path="/code/language/python/python-asyncio.html">...</span></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#asyncio-â€”-å¼‚æ­¥-i-o-åç¨‹" class="router-link-active router-link-exact-active toc-link level2">asyncio â€” å¼‚æ­¥ I/O &amp; åç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹ä¸ä»»åŠ¡" class="router-link-active router-link-exact-active toc-link level2">åç¨‹ä¸ä»»åŠ¡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹" class="router-link-active router-link-exact-active toc-link level3">åç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¯ç­‰å¾…å¯¹è±¡-awaitable-objects" class="router-link-active router-link-exact-active toc-link level3">å¯ç­‰å¾…å¯¹è±¡ awaitable objects</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åç¨‹-1" class="router-link-active router-link-exact-active toc-link level3">åç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä»»åŠ¡" class="router-link-active router-link-exact-active toc-link level3">ä»»åŠ¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#futures" class="router-link-active router-link-exact-active toc-link level3">Futures</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#è¿è¡Œ-asyncio-ç¨‹åº" class="router-link-active router-link-exact-active toc-link level3">è¿è¡Œ asyncio ç¨‹åº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åˆ›å»ºä»»åŠ¡" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºä»»åŠ¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¼‘çœ " class="router-link-active router-link-exact-active toc-link level3">ä¼‘çœ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¹¶å‘è¿è¡Œä»»åŠ¡" class="router-link-active router-link-exact-active toc-link level3">å¹¶å‘è¿è¡Œä»»åŠ¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å±è”½å–æ¶ˆæ“ä½œ" class="router-link-active router-link-exact-active toc-link level3">å±è”½å–æ¶ˆæ“ä½œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#è¶…æ—¶" class="router-link-active router-link-exact-active toc-link level3">è¶…æ—¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ç®€å•ç­‰å¾…" class="router-link-active router-link-exact-active toc-link level3">ç®€å•ç­‰å¾…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åœ¨çº¿ç¨‹ä¸­è¿è¡Œ" class="router-link-active router-link-exact-active toc-link level3">åœ¨çº¿ç¨‹ä¸­è¿è¡Œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#è·¨çº¿ç¨‹è°ƒåº¦" class="router-link-active router-link-exact-active toc-link level3">è·¨çº¿ç¨‹è°ƒåº¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å†…çœ" class="router-link-active router-link-exact-active toc-link level3">å†…çœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#task-å¯¹è±¡" class="router-link-active router-link-exact-active toc-link level3">Task å¯¹è±¡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#stream-æµ" class="router-link-active router-link-exact-active toc-link level2">Stream æµ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#stream-å‡½æ•°" class="router-link-active router-link-exact-active toc-link level3">Stream å‡½æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#unix-å¥—æ¥å­—-socket" class="router-link-active router-link-exact-active toc-link level3">Unix å¥—æ¥å­—ï¼ˆSocketï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#streamreader-ä¸-streamwriter" class="router-link-active router-link-exact-active toc-link level3">StreamReader ä¸ StreamWriter</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¾‹å­-echo-æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯" class="router-link-active router-link-exact-active toc-link level3">ä¾‹å­ï¼šecho æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åŒæ­¥åŸè¯­" class="router-link-active router-link-exact-active toc-link level2">åŒæ­¥åŸè¯­</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#lock" class="router-link-active router-link-exact-active toc-link level3">Lock</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#event" class="router-link-active router-link-exact-active toc-link level3">Event</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#condition" class="router-link-active router-link-exact-active toc-link level3">Condition</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#semaphore" class="router-link-active router-link-exact-active toc-link level3">Semaphore</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#boundedsemaphore" class="router-link-active router-link-exact-active toc-link level3">BoundedSemaphore</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#é˜Ÿåˆ—é›†åˆ" class="router-link-active router-link-exact-active toc-link level2">é˜Ÿåˆ—é›†åˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#queue" class="router-link-active router-link-exact-active toc-link level3">Queue</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="router-link-active router-link-exact-active toc-link level3">ä¼˜å…ˆçº§é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åè¿›å…ˆå‡ºé˜Ÿåˆ—" class="router-link-active router-link-exact-active toc-link level3">åè¿›å…ˆå‡ºé˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä¾‹å­" class="router-link-active router-link-exact-active toc-link level3">ä¾‹å­</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#äº‹ä»¶å¾ªç¯" class="router-link-active router-link-exact-active toc-link level2">äº‹ä»¶å¾ªç¯</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å‰è¨€" class="router-link-active router-link-exact-active toc-link level3">å‰è¨€</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#é«˜å±‚çº§-api-ç´¢å¼•" class="router-link-active router-link-exact-active toc-link level2">é«˜å±‚çº§ API ç´¢å¼•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#ä»»åŠ¡-1" class="router-link-active router-link-exact-active toc-link level3">ä»»åŠ¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#é˜Ÿåˆ—é›†" class="router-link-active router-link-exact-active toc-link level3">é˜Ÿåˆ—é›†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å­è¿›ç¨‹é›†" class="router-link-active router-link-exact-active toc-link level3">å­è¿›ç¨‹é›†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#æµ" class="router-link-active router-link-exact-active toc-link level3">æµ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#åŒæ­¥" class="router-link-active router-link-exact-active toc-link level3">åŒæ­¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å¼‚å¸¸" class="router-link-active router-link-exact-active toc-link level3">å¼‚å¸¸</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/code/language/python/python-asyncio.html#å…³äº-never-awaited-åç¨‹" class="router-link-active router-link-exact-active toc-link level2">å…³äº never-awaited åç¨‹</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p>è¿™é‡Œå®é™…ä¸Šå°±æ˜¯å®˜æ–¹æ–‡æ¡£çš„æ¬è¿ï¼Œéå¸¸ä¸å®Œæ•´ï¼Œå»ºè®®ç›´æ¥çœ‹<a href="https://docs.python.org/zh-cn/3.10/library/asyncio.html" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></div><h2 id="asyncio-â€”-å¼‚æ­¥-i-o-åç¨‹" tabindex="-1"><a class="header-anchor" href="#asyncio-â€”-å¼‚æ­¥-i-o-åç¨‹" aria-hidden="true">#</a> asyncio â€” å¼‚æ­¥ I/O &amp; åç¨‹</h2><p>åç¨‹è¿è¡Œçš„åŸç†è§ï¼š <a href="/code/language/python/python-concurrent.html#%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E4%BB%A3%E7%A0%81" class="">åç¨‹çš„åŸç†ä»¥åŠä»£ç </a></p><p>asyncio æ˜¯ç”¨æ¥ç¼–å†™ Â <strong>å¹¶å‘</strong>Â  ä»£ç çš„åº“ï¼Œä½¿ç”¨ Â <strong>async/await</strong>Â  è¯­æ³•ã€‚</p><p>asyncio è¢«ç”¨ä½œå¤šä¸ªæä¾›é«˜æ€§èƒ½ Python å¼‚æ­¥æ¡†æ¶çš„åŸºç¡€ï¼ŒåŒ…æ‹¬ç½‘ç»œå’Œç½‘ç«™æœåŠ¡ï¼Œæ•°æ®åº“è¿æ¥åº“ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ç­‰ç­‰ã€‚</p><p>asyncio å¾€å¾€æ˜¯æ„å»º IO å¯†é›†å‹å’Œé«˜å±‚çº§ Â <strong>ç»“æ„åŒ–</strong>Â  ç½‘ç»œä»£ç çš„æœ€ä½³é€‰æ‹©ã€‚</p><p>asyncio æä¾›ä¸€ç»„ Â <strong>é«˜å±‚çº§</strong>Â API ç”¨äº:</p><ul><li>å¹¶å‘åœ° Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#coroutine" target="_blank" rel="noopener noreferrer">è¿è¡Œ Python åç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¹¶å¯¹å…¶æ‰§è¡Œè¿‡ç¨‹å®ç°å®Œå…¨æ§åˆ¶;</li><li>æ‰§è¡Œ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-stream.html#asyncio-streams" target="_blank" rel="noopener noreferrer">ç½‘ç»œ IO å’Œ IPC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>;</li><li>æ§åˆ¶ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-subprocess.html#asyncio-subprocess" target="_blank" rel="noopener noreferrer">å­è¿›ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>;</li><li>é€šè¿‡ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio-queues" target="_blank" rel="noopener noreferrer">é˜Ÿåˆ—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å®ç°åˆ†å¸ƒå¼ä»»åŠ¡;</li><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio-sync" target="_blank" rel="noopener noreferrer">åŒæ­¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¹¶å‘ä»£ç ;</li></ul><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº› Â <strong>ä½å±‚çº§</strong>Â API ä»¥æ”¯æŒ Â <em>åº“å’Œæ¡†æ¶çš„å¼€å‘è€…</em>Â  å®ç°:</p><ul><li>åˆ›å»ºå’Œç®¡ç† Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-eventloop.html#asyncio-event-loop" target="_blank" rel="noopener noreferrer">äº‹ä»¶å¾ªç¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä»¥æä¾›å¼‚æ­¥ API ç”¨äº Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-eventloop.html#asyncio.loop.create_server" target="_blank" rel="noopener noreferrer">ç½‘ç»œåŒ–<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, è¿è¡Œ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-eventloop.html#asyncio.loop.subprocess_exec" target="_blank" rel="noopener noreferrer">å­è¿›ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå¤„ç† Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-eventloop.html#asyncio.loop.add_signal_handler" target="_blank" rel="noopener noreferrer">OS ä¿¡å·<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ç­‰ç­‰;</li><li>ä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-protocol.html#asyncio-transports-protocols" target="_blank" rel="noopener noreferrer">transports<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å®ç°é«˜æ•ˆç‡åè®®;</li><li>é€šè¿‡ async/await è¯­æ³• Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-future.html#asyncio-futures" target="_blank" rel="noopener noreferrer">æ¡¥æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  åŸºäºå›è°ƒçš„åº“å’Œä»£ç ã€‚</li></ul><h2 id="åç¨‹ä¸ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#åç¨‹ä¸ä»»åŠ¡" aria-hidden="true">#</a> åç¨‹ä¸ä»»åŠ¡ <sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></h2><h3 id="åç¨‹" tabindex="-1"><a class="header-anchor" href="#åç¨‹" aria-hidden="true">#</a> åç¨‹</h3><p>é€šè¿‡ async/await å…³é”®å­—æ¥å®šä¹‰çš„åç¨‹æ˜¯ä¸€ç§è¢«æ¨èçš„ç¼–å†™å¼‚æ­¥ç¨‹åºçš„æ–¹å¼ã€‚</p><p>ä¸‹é¢çš„ä»£ç å®šä¹‰å¹¶è¿è¡Œäº†ä¸€ä¸ªåç¨‹ï¼š</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> asyncio

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;world&#39;</span><span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hello
world
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šç®€å•åœ°è°ƒç”¨ä¸€ä¸ªåç¨‹å¹¶ä¸ä¼šä½¿å…¶è¢«è°ƒåº¦æ‰§è¡Œã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>coroutine <span class="token builtin">object</span> main at <span class="token number">0x1053bb7c8</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦æ­£åœ¨è¿è¡Œä¸€ä¸ªåç¨‹ï¼Œasyncio æä¾›äº†ä¸‰ç§ä¸»è¦æœºåˆ¶ï¼š</p><ol><li><p><code>asyncio.run()</code> å‡½æ•°ç”¨æ¥è¿è¡Œæœ€é«˜å±‚çº§çš„å…¥å£ç‚¹ â€œmain()â€ å‡½æ•°</p></li><li><p><code>await</code> ä¸€ä¸ªåç¨‹ã€‚ä»¥ä¸‹ä»£ç ä¼šåœ¨ç­‰å¾… 1 ç§’åæ‰“å°â€œhelloâ€ï¼Œç„¶åç­‰å¾… 2 ç§’åæ‰“å°â€œworldâ€ã€‚ï¼ˆawait ä¸€ä¸ªåç¨‹ä¼šè®©å…¶å¼€å§‹è¿è¡Œï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆï¼‰</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> time

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">say_after</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> what<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>what<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;started at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> say_after<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> say_after<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;world&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;finished at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># started at 17:13:52</span>
<span class="token comment"># hello</span>
<span class="token comment"># world</span>
<span class="token comment"># finished at 17:13:55</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>asyncio.create_task()</code> å‡½æ•°ç”¨æ¥å¹¶å‘è¿è¡Œä½œä¸º asyncio ä»»åŠ¡çš„å¤šä¸ªåç¨‹ã€‚ï¼ˆcreate_task()ä¹‹åä¼šä½¿ä»»åŠ¡å‡ºäºå°±ç»ªçŠ¶æ€éšæ—¶å‡†å¤‡è¿è¡Œï¼Œè€Œ await task åˆ™æ˜¯ç­‰å¾…è¿™ä¸ªä»»åŠ¡è¿è¡Œå®Œæˆï¼‰</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    task1 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>
        say_after<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    task2 <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>
        say_after<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;world&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;started at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    <span class="token comment"># Wait until both tasks are completed (should take</span>
    <span class="token comment"># around 2 seconds.)</span>
    <span class="token keyword">await</span> task1
    <span class="token keyword">await</span> task2

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;finished at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># æ¯”ä¸Šé¢çš„è¦å¿«1ç§’ï¼Œå› ä¸ºä¸¤ä¸ªtaskæ˜¯åŒæ—¶è¿è¡Œçš„</span>
<span class="token comment"># started at 17:14:32</span>
<span class="token comment"># hello</span>
<span class="token comment"># world</span>
<span class="token comment"># finished at 17:14:34</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="å¯ç­‰å¾…å¯¹è±¡-awaitable-objects" tabindex="-1"><a class="header-anchor" href="#å¯ç­‰å¾…å¯¹è±¡-awaitable-objects" aria-hidden="true">#</a> å¯ç­‰å¾…å¯¹è±¡ awaitable objects</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡å¯ä»¥åœ¨ await è¯­å¥ä¸­ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ awaitable å¯¹è±¡ã€‚è®¸å¤š asyncio API éƒ½è¢«è®¾è®¡ä¸ºæ¥å— awaitable å¯¹è±¡ã€‚</p><p>å¯ç­‰å¾… å¯¹è±¡æœ‰ä¸‰ç§ä¸»è¦ç±»å‹ï¼šåç¨‹ï¼ˆCoroutineï¼‰ã€ä»»åŠ¡ï¼ˆTaskï¼‰ã€Futureã€‚</p><h3 id="åç¨‹-1" tabindex="-1"><a class="header-anchor" href="#åç¨‹-1" aria-hidden="true">#</a> åç¨‹</h3><p>Python åç¨‹å±äºå¯ç­‰å¾…å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥åœ¨å…¶ä»–åç¨‹ä¸­è¢«ç­‰å¾…ï¼š</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">42</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Nothing happens if we just call &quot;nested()&quot;.</span>
    <span class="token comment"># A coroutine object is created but not awaited,</span>
    <span class="token comment"># so it *won&#39;t run at all*.</span>
    nested<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># è¿™ä¸ªä¸ä¼šè¿è¡Œï¼Œåªæ˜¯å•çº¯è¿”å›äº†ä¸€ä¸ªcoroutineå¯¹è±¡</span>

    <span class="token comment"># Let&#39;s do it differently now and await it:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">await</span> nested<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># will print &quot;42&quot;.  # è¿™é‡Œä¼šè¿è¡Œï¼Œå› ä¸ºæœ‰await</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é‡è¦</strong></p><p>åœ¨æœ¬æ–‡æ¡£ä¸­ &quot;åç¨‹&quot; å¯ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªç´§å¯†å…³è”çš„æ¦‚å¿µ:</p><ul><li><em>åç¨‹å‡½æ•°</em>: å®šä¹‰å½¢å¼ä¸º Â <code>[async def](https://docs.python.org/zh-cn/3/reference/compound_stmts.html#async-def)</code>Â  çš„å‡½æ•°;</li><li><em>åç¨‹å¯¹è±¡</em>: è°ƒç”¨ Â <em>åç¨‹å‡½æ•°</em>Â  æ‰€è¿”å›çš„å¯¹è±¡ã€‚</li></ul><h3 id="ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#ä»»åŠ¡" aria-hidden="true">#</a> ä»»åŠ¡</h3><p>Task è¢«ç”¨æ¥ â€œå¹¶è¡Œåœ°â€ è°ƒåº¦åç¨‹ã€‚</p><p>å½“ä¸€ä¸ªåç¨‹é€šè¿‡ asyncio.create_task() ç­‰å‡½æ•°è¢«å°è£…ä¸ºäº†ä¸€ä¸ª Taskï¼Œè¯¥åç¨‹ä¼šè¢«è‡ªåŠ¨è°ƒåº¦æ‰§è¡Œï¼š</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">42</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Schedule nested() to run soon concurrently</span>
    <span class="token comment"># with &quot;main()&quot;.</span>
    task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>nested<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># è¿™é‡Œ task å°±å¼€å§‹è¿è¡Œäº†</span>

    <span class="token comment"># &quot;task&quot; can now be used to cancel &quot;nested()&quot;, or</span>
    <span class="token comment"># can simply be awaited to wait until it is complete:</span>
    <span class="token keyword">await</span> task  <span class="token comment"># è¿™é‡Œåªæ˜¯å•çº¯åœ°ç­‰å¾…å…¶è¿è¡Œå®Œ</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="futures" tabindex="-1"><a class="header-anchor" href="#futures" aria-hidden="true">#</a> Futures</h3><p>Future æ˜¯ä¸€ç§ç‰¹æ®Šçš„ <strong>ä½å±‚çº§</strong> å¯ç­‰å¾…å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ <strong>æœ€ç»ˆç»“æœ</strong>ã€‚</p><p>å½“ä¸€ä¸ª Future å¯¹è±¡ <em>è¢«ç­‰å¾…</em>ï¼Œè¿™æ„å‘³ç€åç¨‹å°†ä¿æŒç­‰å¾…ç›´åˆ°è¯¥ Future å¯¹è±¡åœ¨å…¶ä»–åœ°æ–¹æ“ä½œå®Œæ¯•ã€‚</p><p>åœ¨ asyncio ä¸­éœ€è¦ Future å¯¹è±¡ä»¥ä¾¿å…è®¸ async/await ä½¿ç”¨åŸºäºå›è°ƒçš„ä»£ç ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ <strong>æ²¡æœ‰å¿…è¦</strong> åœ¨åº”ç”¨å±‚çº§çš„ä»£ç ä¸­åˆ›å»º Future å¯¹è±¡ã€‚</p><p>Future å¯¹è±¡æœ‰æ—¶ä¼šç”±åº“å’ŒæŸäº› asyncio API æš´éœ²ç»™ç”¨æˆ·ï¼Œç”¨ä½œå¯ç­‰å¾…å¯¹è±¡ï¼š</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> function_that_returns_a_future_object<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># this is also valid:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>
        function_that_returns_a_future_object<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        some_python_coroutine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ªå¾ˆå¥½çš„è¿”å›å¯¹è±¡çš„ä½å±‚çº§å‡½æ•°çš„ç¤ºä¾‹æ˜¯ï¼šloop.run_in_executor()</p><h3 id="è¿è¡Œ-asyncio-ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œ-asyncio-ç¨‹åº" aria-hidden="true">#</a> è¿è¡Œ asyncio ç¨‹åº</h3><p><code>asyncio.run(coro, *, debug=False)</code></p><p>æ‰§è¡Œ coro å¹¶è¿”å›ç»“æœã€‚</p><p>åƒå‡½æ•°ä¼šè¿è¡Œä¼ å…¥çš„åç¨‹ï¼Œè´Ÿè´£ç®¡ç† asyncio äº‹ä»¶å¾ªç¯ï¼Œç»ˆç»“å¼‚æ­¥ç”Ÿæˆå™¨ï¼Œå¹¶å…³é—­çº¿ç¨‹æ± ã€‚</p><p>ä½†æœ‰å…¶ä»– asyncio äº‹ä»¶å¾ªç¯åœ¨åŒä¸€çº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œæ­¤å‡½æ•°ä¸èƒ½è¢«è°ƒç”¨ã€‚</p><p>å¦‚æœ debug ä¸º Trueï¼Œäº‹ä»¶å¾ªç¯å°†ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œã€‚</p><p>æ­¤å‡½æ•°<strong>æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯</strong>å¹¶åœ¨ç»“æŸæ—¶å…³é—­ä¹‹ã€‚å®ƒåº”å½“ç”¨ä½œ asyncio ç¨‹åºçš„ä¸»å…¥å£ç‚¹ï¼Œç†æƒ³æƒ…å†µä¸‹åº”å½“åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä»»åŠ¡" aria-hidden="true">#</a> åˆ›å»ºä»»åŠ¡</h3><p><code>asyncio.create_task(coro, *, name=None)</code></p><p>å°† coro å°è£…ä¸ºä¸€ä¸ª Task å¹¶è°ƒåº¦å…¶æ‰§è¡Œã€‚è¿”å› Task å¯¹è±¡ã€‚</p><p>name ä¸ä¸º None æ—¶ï¼Œå®ƒå°†ä½¿ç”¨ Task.set_name() æ¥è®¾ä¸ºä»»åŠ¡çš„åç§°ã€‚</p><p>è¯¥ä»»åŠ¡ä¼šåœ¨ get_running_loop() è¿”å›çš„å¾ªç¯ä¸­æ‰§è¡Œï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰åœ¨è¿è¡Œçš„å¾ªç¯åˆ™ä¼šå¼•å‘ RuntimeErrorã€‚</p><div class="custom-container info"><p class="custom-container-title">ç›¸å…³ä¿¡æ¯</p><p>éœ€è¦ä¿å­˜è¿™ä¸ªæ–¹æ³•è¿”å›å€¼ Task çš„å¼•ç”¨ï¼Œå› ä¸º event_loop ä¸­åªä¼šä¿å­˜ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œå¦‚æœä¸ä¿å­˜å¼•ç”¨ï¼Œå¯èƒ½è¿™ä¸ªåç¨‹æ²¡æœ‰è¢«æ‰§è¡Œå®Œæ¯•å°±è¢«åƒåœ¾å›æ”¶ç»™æ¸…ç†äº†ã€‚</p></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>background_tasks <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>some_coro<span class="token punctuation">(</span>param<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Add task to the set. This creates a strong reference.</span>
    background_tasks<span class="token punctuation">.</span>add<span class="token punctuation">(</span>task<span class="token punctuation">)</span>

    <span class="token comment"># To prevent keeping references to finished tasks forever,</span>
    <span class="token comment"># make each task remove its own reference from the set after</span>
    <span class="token comment"># completion:</span>
    task<span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>background_tasks<span class="token punctuation">.</span>discard<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¼‘çœ " tabindex="-1"><a class="header-anchor" href="#ä¼‘çœ " aria-hidden="true">#</a> ä¼‘çœ </h3><p><code>coroutine asyncio.sleep(delay, result=None)</code></p><p>é˜»å¡ delay æŒ‡å®šçš„ç§’æ•°ã€‚</p><p>å¦‚æœæŒ‡å®šäº† resultï¼Œåˆ™å½“åç¨‹å®Œæˆæ—¶ result å…¶è¿”å›ç»™è°ƒç”¨è€…ã€‚</p><p>sleep() æ€»æ˜¯ä¼šæŒ‚èµ·å½“å‰ä»»åŠ¡ï¼Œä»¥å…è®¸å…¶ä»–ä»»åŠ¡è¿è¡Œã€‚</p><p>å°† delay è®¾ä¸º 0 å°†æä¾›ä¸€ä¸ªç»ä¼˜åŒ–çš„è·¯å¾„ä»¥å…è®¸å…¶ä»–ä»»åŠ¡è¿è¡Œã€‚ è¿™å¯ä¾›é•¿æœŸé—´è¿è¡Œçš„å‡½æ•°ä½¿ç”¨ä»¥é¿å…åœ¨å‡½æ•°è°ƒç”¨çš„å…¨è¿‡ç¨‹ä¸­é˜»å¡äº‹ä»¶å¾ªç¯ã€‚</p><p>ä»¥ä¸‹åç¨‹ç¤ºä¾‹è¿è¡Œ 5 ç§’ï¼Œæ¯ç§’æ˜¾ç¤ºä¸€æ¬¡å½“å‰æ—¥æœŸ:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> datetime

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">display_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_running_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    end_time <span class="token operator">=</span> loop<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5.0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loop<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> end_time<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>display_date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¹¶å‘è¿è¡Œä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘è¿è¡Œä»»åŠ¡" aria-hidden="true">#</a> å¹¶å‘è¿è¡Œä»»åŠ¡</h3><p><code>awaitable asyncio.gather(*aws, return_exceptions=False)</code></p><p><em>å¹¶å‘</em> è¿è¡Œ aws åºåˆ—ä¸­çš„ å¯ç­‰å¾…å¯¹è±¡ã€‚</p><p>å¦‚æœ aws ä¸­çš„æŸä¸ªå¯ç­‰å¾…å¯¹è±¡ä¸ºåç¨‹ï¼Œå®ƒå°†è‡ªåŠ¨è¢«ä½œä¸ºä¸€ä¸ªä»»åŠ¡è°ƒåº¦ã€‚</p><p>å¦‚æœæ‰€æœ‰å¯ç­‰å¾…å¯¹è±¡éƒ½æˆåŠŸå®Œæˆï¼Œç»“æœå°†æ˜¯ä¸€ä¸ªç”±æ‰€æœ‰è¿”å›å€¼èšåˆè€Œå±‚çš„åˆ—è¡¨ã€‚ç»“æœå€¼çš„é¡ºåºä¸ aws ä¸­å¯ç­‰å¾…å¯¹è±¡çš„<strong>é¡ºåºä¸€è‡´</strong>ã€‚</p><p>å¦‚æœ return_exceptions ä¸º Falseï¼Œæ‰€å¼•å‘çš„é¦–ä¸ªå¼‚å¸¸ä¼šç«‹å³ä¼ æ’­ç»™ç­‰å¾… gather() çš„ä»»åŠ¡ã€‚aws åºåˆ—ä¸­çš„å…¶ä»–å¯ç­‰å¾…å¯¹è±¡ <strong>ä¸ä¼šè¢«å–æ¶ˆ</strong> å¹¶ç»§ç»­è¿è¡Œã€‚</p><p>å¦‚æœ return_exceptions ä¸º Trueï¼Œå¼‚å¸¸ä¼šå’ŒæˆåŠŸçš„ç»“æœä¸€æ ·å¤„ç†ï¼Œå¹¶èšåˆè‡³ç»“æœåˆ—è¡¨ã€‚</p><p>å¦‚æœ gather() è¢«å–æ¶ˆï¼Œæ‰€æœ‰è¢«æäº¤ï¼ˆå°šæœªå®Œæˆï¼‰çš„å¯ç­‰å¾…å¯¹è±¡ä¹Ÿä¼š è¢«å–æ¶ˆã€‚</p><p>å¦‚æœ aws åºåˆ—ä¸­çš„ä»»ä¸€ Task æˆ– Future å¯¹è±¡ è¢«å–æ¶ˆï¼Œå®ƒå°†è¢«å½“ä½œå¼•å‘äº† CancelledError ä¸€æ ·å¤„ç† â€” åœ¨æ­¤æƒ…å†µä¸‹ gather() è°ƒç”¨ <strong>ä¸ä¼š</strong> è¢«å–æ¶ˆã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ä¸€ä¸ªå·²æäº¤çš„ Task/Future è¢«å–æ¶ˆå¯¼è‡´å…¶ä»– Tasks/Future ä¹Ÿè¢«å–æ¶ˆã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">factorial</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">: Compute factorial(</span><span class="token interpolation"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span><span class="token string">), currently i=</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        f <span class="token operator">*=</span> i
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">: factorial(</span><span class="token interpolation"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span><span class="token string">) = </span><span class="token interpolation"><span class="token punctuation">{</span>f<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> f

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Schedule three calls *concurrently*:</span>
    L <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>
        factorial<span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        factorial<span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        factorial<span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Expected output:</span>
<span class="token comment">#</span>
<span class="token comment">#     Task A: Compute factorial(2), currently i=2...</span>
<span class="token comment">#     Task B: Compute factorial(3), currently i=2...</span>
<span class="token comment">#     Task C: Compute factorial(4), currently i=2...</span>
<span class="token comment">#     Task A: factorial(2) = 2</span>
<span class="token comment">#     Task B: Compute factorial(3), currently i=3...</span>
<span class="token comment">#     Task C: Compute factorial(4), currently i=3...</span>
<span class="token comment">#     Task B: factorial(3) = 6</span>
<span class="token comment">#     Task C: Compute factorial(4), currently i=4...</span>
<span class="token comment">#     Task C: factorial(4) = 24</span>
<span class="token comment">#     [2, 6, 24]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container info"><p class="custom-container-title">ç›¸å…³ä¿¡æ¯</p><p>å¦‚æœ Â <em>return_exceptions</em>Â  ä¸º Falseï¼Œåˆ™åœ¨ gather() è¢«æ ‡è®°ä¸ºå·²å®Œæˆåå–æ¶ˆå®ƒå°†ä¸ä¼šå–æ¶ˆä»»ä½•å·²æäº¤çš„å¯ç­‰å¾…å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œåœ¨å°†ä¸€ä¸ªå¼‚å¸¸ä¼ æ’­ç»™è°ƒç”¨è€…ä¹‹åï¼Œgather å¯è¢«æ ‡è®°ä¸ºå·²å®Œæˆï¼Œå› æ­¤ï¼Œåœ¨ä» gather æ•è·ä¸€ä¸ªï¼ˆç”±å¯ç­‰å¾…å¯¹è±¡æ‰€å¼•å‘çš„ï¼‰å¼‚å¸¸ä¹‹åè°ƒç”¨ Â <code>gather.cancel()</code>Â  å°†ä¸ä¼šå–æ¶ˆä»»ä½•å…¶ä»–å¯ç­‰å¾…å¯¹è±¡ã€‚</p></div><h3 id="å±è”½å–æ¶ˆæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å±è”½å–æ¶ˆæ“ä½œ" aria-hidden="true">#</a> å±è”½å–æ¶ˆæ“ä½œ</h3><p><code>awaitable asyncio.shield(aw)</code></p><p>ä¿æŠ¤ä¸€ä¸ª Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio-awaitables" target="_blank" rel="noopener noreferrer">å¯ç­‰å¾…å¯¹è±¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  é˜²æ­¢å…¶è¢« Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task.cancel" target="_blank" rel="noopener noreferrer">å–æ¶ˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>å¦‚æœ Â <em>aw</em>Â  æ˜¯ä¸€ä¸ªåç¨‹ï¼Œå®ƒå°†è‡ªåŠ¨è¢«ä½œä¸ºä»»åŠ¡è°ƒåº¦ã€‚</p><p>ä»¥ä¸‹è¯­å¥:</p><p><code>res = **await** shield(something())</code></p><p>ç›¸å½“äº:</p><p><code>res = **await** something()</code></p><p><em>ä¸åŒä¹‹å¤„</em>Â  åœ¨äºå¦‚æœåŒ…å«å®ƒçš„åç¨‹è¢«å–æ¶ˆï¼Œåœ¨ Â <code>something()</code>Â  ä¸­è¿è¡Œçš„ä»»åŠ¡ä¸ä¼šè¢«å–æ¶ˆã€‚ä» Â <code>something()</code>Â  çš„è§’åº¦çœ‹æ¥ï¼Œå–æ¶ˆæ“ä½œå¹¶æ²¡æœ‰å‘ç”Ÿã€‚ç„¶è€Œå…¶è°ƒç”¨è€…å·²è¢«å–æ¶ˆï¼Œå› æ­¤ &quot;await&quot; è¡¨è¾¾å¼ä»ç„¶ä¼šå¼•å‘<a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.CancelledError" target="_blank" rel="noopener noreferrer">CancelledError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h3 id="è¶…æ—¶" tabindex="-1"><a class="header-anchor" href="#è¶…æ—¶" aria-hidden="true">#</a> è¶…æ—¶</h3><p><code>coroutine asyncio.wait_for(aw, timeout)</code></p><p>ç­‰å¾… Â <em>aw</em>Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio-awaitables" target="_blank" rel="noopener noreferrer">å¯ç­‰å¾…å¯¹è±¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å®Œæˆï¼ŒæŒ‡å®š timeout ç§’æ•°åè¶…æ—¶ã€‚</p><p>å¦‚æœ Â <em>aw</em>Â  æ˜¯ä¸€ä¸ªåç¨‹ï¼Œå®ƒå°†è‡ªåŠ¨è¢«ä½œä¸ºä»»åŠ¡è°ƒåº¦ã€‚</p><p><em>timeout</em>Â  å¯ä»¥ä¸º Â <code>None</code>ï¼Œä¹Ÿå¯ä»¥ä¸º float æˆ– int å‹æ•°å€¼è¡¨ç¤ºçš„ç­‰å¾…ç§’æ•°ã€‚å¦‚æœ Â <em>timeout</em>Â  ä¸º Â <code>None</code>ï¼Œåˆ™ç­‰å¾…ç›´åˆ°å®Œæˆã€‚</p><p>å¦‚æœå‘ç”Ÿè¶…æ—¶ï¼Œä»»åŠ¡å°†å–æ¶ˆå¹¶å¼•å‘ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.TimeoutError" target="_blank" rel="noopener noreferrer">asyncio.TimeoutError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>è¦é¿å…ä»»åŠ¡ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task.cancel" target="_blank" rel="noopener noreferrer">å–æ¶ˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå¯ä»¥åŠ ä¸Š Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.shield" target="_blank" rel="noopener noreferrer">shield()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>æ­¤å‡½æ•°å°†ç­‰å¾…ç›´åˆ° Future ç¡®å®è¢«å–æ¶ˆï¼Œæ‰€ä»¥æ€»ç­‰å¾…æ—¶é—´å¯èƒ½è¶…è¿‡ Â <em>timeout</em>ã€‚ å¦‚æœåœ¨å–æ¶ˆæœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¼‚å¸¸å°†ä¼šè¢«ä¼ æ’­ã€‚</p><p>å¦‚æœç­‰å¾…è¢«å–æ¶ˆï¼Œåˆ™ Â <em>aw</em>Â  æŒ‡å®šçš„å¯¹è±¡ä¹Ÿä¼šè¢«å–æ¶ˆã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">eternity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Sleep for one hour</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;yay!&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Wait for at most 1 second</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>wait_for<span class="token punctuation">(</span>eternity<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> asyncio<span class="token punctuation">.</span>TimeoutError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;timeout!&#39;</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Expected output:</span>
<span class="token comment">#</span>
<span class="token comment">#     timeout!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç®€å•ç­‰å¾…" tabindex="-1"><a class="header-anchor" href="#ç®€å•ç­‰å¾…" aria-hidden="true">#</a> ç®€å•ç­‰å¾…</h3><p>å¹¶å‘åœ°è¿è¡Œ Â <em>aws</em>Â  å¯è¿­ä»£å¯¹è±¡ä¸­çš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio-awaitables" target="_blank" rel="noopener noreferrer">å¯ç­‰å¾…å¯¹è±¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¹¶è¿›å…¥é˜»å¡çŠ¶æ€ç›´åˆ°æ»¡è¶³ Â <em>return_when</em>Â  æ‰€æŒ‡å®šçš„æ¡ä»¶ã€‚</p><p><em>aws</em>Â  å¯è¿­ä»£å¯¹è±¡å¿…é¡»ä¸ä¸ºç©ºã€‚</p><p>è¿”å›ä¸¤ä¸ª Task/Future é›†åˆ:Â <code>(done, pending)</code>ã€‚</p><p>ç”¨æ³•ï¼š</p><p><code>done, pending = **await** asyncio.wait(aws)</code></p><p>å¦‚æŒ‡å®š Â <em>timeout</em>Â (float æˆ– int ç±»å‹) åˆ™å®ƒå°†è¢«ç”¨äºæ§åˆ¶è¿”å›ä¹‹å‰ç­‰å¾…çš„æœ€é•¿ç§’æ•°ã€‚</p><p>è¯·æ³¨æ„æ­¤å‡½æ•°ä¸ä¼šå¼•å‘ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.TimeoutError" target="_blank" rel="noopener noreferrer">asyncio.TimeoutError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚å½“è¶…æ—¶å‘ç”Ÿæ—¶ï¼Œæœªå®Œæˆçš„ Future æˆ– Task å°†åœ¨æŒ‡å®šç§’æ•°åè¢«è¿”å›ã€‚</p><p><em>return_when</em>Â  æŒ‡å®šæ­¤å‡½æ•°åº”åœ¨ä½•æ—¶è¿”å›ã€‚å®ƒå¿…é¡»ä¸ºä»¥ä¸‹å¸¸æ•°ä¹‹ä¸€:</p><table><thead><tr><th>å¸¸é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td>FIRST_COMPLETED</td><td>å‡½æ•°å°†åœ¨ä»»æ„å¯ç­‰å¾…å¯¹è±¡ç»“æŸæˆ–å–æ¶ˆæ—¶è¿”å›ã€‚</td></tr><tr><td>FIRST_EXCEPTION</td><td>å‡½æ•°å°†åœ¨ä»»æ„å¯ç­‰å¾…å¯¹è±¡å› å¼•å‘å¼‚å¸¸è€Œç»“æŸæ—¶è¿”å›ã€‚å½“æ²¡æœ‰å¼•å‘ä»»ä½•å¼‚å¸¸æ—¶å®ƒå°±ç›¸å½“äº Â ALL_COMPLETEDã€‚</td></tr><tr><td>ALL_COMPLETED</td><td>å‡½æ•°å°†åœ¨æ‰€æœ‰å¯ç­‰å¾…å¯¹è±¡ç»“æŸæˆ–å–æ¶ˆæ—¶è¿”å›ã€‚</td></tr></tbody></table><p><code>asyncio.as_completed(aws, *, timeout=None)</code></p><p>å¹¶å‘åœ°è¿è¡Œ Â <em>aws</em>Â  å¯è¿­ä»£å¯¹è±¡ä¸­çš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio-awaitables" target="_blank" rel="noopener noreferrer">å¯ç­‰å¾…å¯¹è±¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ è¿”å›ä¸€ä¸ªåç¨‹çš„è¿­ä»£å™¨ã€‚ æ‰€è¿”å›çš„æ¯ä¸ªåç¨‹å¯è¢«ç­‰å¾…ä»¥ä»å‰©ä½™çš„å¯ç­‰å¾…å¯¹è±¡çš„å¯è¿­ä»£å¯¹è±¡ä¸­è·å¾—æœ€æ—©çš„ä¸‹ä¸€ä¸ªç»“æœã€‚</p><p>å¦‚æœåœ¨æ‰€æœ‰ Future å¯¹è±¡å®Œæˆå‰å‘ç”Ÿè¶…æ—¶åˆ™å°†å¼•å‘ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.TimeoutError" target="_blank" rel="noopener noreferrer">asyncio.TimeoutError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">for</span> coro <span class="token keyword">in</span> as_completed<span class="token punctuation">(</span>aws<span class="token punctuation">)</span><span class="token punctuation">:</span>
    earliest_result <span class="token operator">=</span> <span class="token keyword">await</span> coro
    <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœ¨çº¿ç¨‹ä¸­è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#åœ¨çº¿ç¨‹ä¸­è¿è¡Œ" aria-hidden="true">#</a> åœ¨çº¿ç¨‹ä¸­è¿è¡Œ</h3><p><code>coroutine asyncio.to_thread(func, /, *args, **kwargs)</code></p><p>åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥åœ°è¿è¡Œå‡½æ•° Â <em>func</em>ã€‚</p><p>å‘æ­¤å‡½æ•°æä¾›çš„ä»»ä½• *args å’Œ **kwargs ä¼šè¢«ç›´æ¥ä¼ ç»™ Â *func*ã€‚ å¹¶ä¸”ï¼Œå½“å‰ Â <a href="https://docs.python.org/zh-cn/3/library/contextvars.html#contextvars.Context" target="_blank" rel="noopener noreferrer">contextvars.Context<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ä¼šè¢«ä¼ æ’­ï¼Œå…è®¸åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è®¿é—®æ¥è‡ªäº‹ä»¶å¾ªç¯çš„ä¸Šä¸‹æ–‡å˜é‡ã€‚</p><p>è¿”å›ä¸€ä¸ªå¯è¢«ç­‰å¾…ä»¥è·å– Â <em>func</em>Â  çš„æœ€ç»ˆç»“æœçš„åç¨‹ã€‚</p><p>è¿™ä¸ªåç¨‹å‡½æ•°ä¸»è¦æ˜¯ç”¨äºæ‰§è¡Œåœ¨å…¶ä»–æƒ…å†µä¸‹ä¼šé˜»å¡äº‹ä»¶å¾ªç¯çš„ IO å¯†é›†å‹å‡½æ•°/æ–¹æ³•ã€‚ ä¾‹å¦‚:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">blocking_io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;start blocking_io at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token comment"># Note that time.sleep() can be replaced with any blocking</span>
    <span class="token comment"># IO-bound operation, such as file operations.</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;blocking_io complete at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;started main at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>
        asyncio<span class="token punctuation">.</span>to_thread<span class="token punctuation">(</span>blocking_io<span class="token punctuation">)</span><span class="token punctuation">,</span>
        asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;finished main at </span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%X&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Expected output:</span>
<span class="token comment">#</span>
<span class="token comment"># started main at 19:50:53</span>
<span class="token comment"># start blocking_io at 19:50:53</span>
<span class="token comment"># blocking_io complete at 19:50:54</span>
<span class="token comment"># finished main at 19:50:54</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»»ä½•åç¨‹ä¸­ç›´æ¥è°ƒç”¨ Â blocking_io() å°†ä¼šåœ¨è°ƒç”¨æœŸé—´é˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå¯¼è‡´é¢å¤–çš„ 1 ç§’è¿è¡Œæ—¶é—´ã€‚ è€Œé€šè¿‡æ”¹ç”¨ Â asyncio.to_thread()ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¿è¡Œå®ƒä»è€Œä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ã€‚</p><h3 id="è·¨çº¿ç¨‹è°ƒåº¦" tabindex="-1"><a class="header-anchor" href="#è·¨çº¿ç¨‹è°ƒåº¦" aria-hidden="true">#</a> è·¨çº¿ç¨‹è°ƒåº¦</h3><p><code>asyncio.run_coroutine_threadsafe(coro, loop)</code></p><p>å‘æŒ‡å®šäº‹ä»¶å¾ªç¯æäº¤ä¸€ä¸ªåç¨‹ã€‚ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</p><p>è¿”å›ä¸€ä¸ª Â <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.Future" target="_blank" rel="noopener noreferrer">concurrent.futures.Future<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ä»¥ç­‰å¾…æ¥è‡ªå…¶ä»– OS çº¿ç¨‹çš„ç»“æœã€‚</p><p>æ­¤å‡½æ•°åº”è¯¥ä»å¦ä¸€ä¸ª OS çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œè€Œéäº‹ä»¶å¾ªç¯è¿è¡Œæ‰€åœ¨çº¿ç¨‹ã€‚ç¤ºä¾‹:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Create a coroutine</span>
coro <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> result<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># Submit the coroutine to a given loop</span>
future <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>run_coroutine_threadsafe<span class="token punctuation">(</span>coro<span class="token punctuation">,</span> loop<span class="token punctuation">)</span>

<span class="token comment"># Wait for the result with an optional timeout argument</span>
<span class="token keyword">assert</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœåœ¨åç¨‹å†…äº§ç”Ÿäº†å¼‚å¸¸ï¼Œå°†ä¼šé€šçŸ¥è¿”å›çš„ Future å¯¹è±¡ã€‚å®ƒä¹Ÿå¯è¢«ç”¨æ¥å–æ¶ˆäº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
<span class="token keyword">except</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>TimeoutError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;The coroutine took too long, cancelling the task...&#39;</span><span class="token punctuation">)</span>
    future<span class="token punctuation">.</span>cancel<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> exc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;The coroutine raised an exception: </span><span class="token interpolation"><span class="token punctuation">{</span>exc<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;The coroutine returned: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‚è§ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-dev.html#asyncio-multithreading" target="_blank" rel="noopener noreferrer">concurrency and multithreading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  éƒ¨åˆ†çš„æ–‡æ¡£ã€‚</p><p>ä¸åŒä¸å…¶ä»– asyncio å‡½æ•°ï¼Œæ­¤å‡½æ•°è¦æ±‚æ˜¾å¼åœ°ä¼ å…¥ Â <em>loop</em>Â  å‚æ•°ã€‚</p><h3 id="å†…çœ" tabindex="-1"><a class="header-anchor" href="#å†…çœ" aria-hidden="true">#</a> å†…çœ</h3><p><code>asyncio.**current_task**(*loop=None*)</code></p><p>è¿”å›å½“å‰è¿è¡Œçš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task" target="_blank" rel="noopener noreferrer">Task<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡åˆ™è¿”å› Â <code>None</code>ã€‚ å¦‚æœ Â <em>loop</em>Â  ä¸º Â <code>None</code>Â  åˆ™ä¼šä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.get_running_loop" target="_blank" rel="noopener noreferrer">get_running_loop()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  è·å–å½“å‰äº‹ä»¶å¾ªç¯ã€‚</p><p><code>asyncio.**all_tasks**(*loop=None*)</code></p><p>è¿”å›äº‹ä»¶å¾ªç¯æ‰€è¿è¡Œçš„æœªå®Œæˆçš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task" target="_blank" rel="noopener noreferrer">Task<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¯¹è±¡çš„é›†åˆã€‚ å¦‚æœ Â <em>loop</em>Â  ä¸º Â <code>None</code>ï¼Œåˆ™ä¼šä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.get_running_loop" target="_blank" rel="noopener noreferrer">get_running_loop()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  è·å–å½“å‰äº‹ä»¶å¾ªç¯ã€‚</p><h3 id="task-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#task-å¯¹è±¡" aria-hidden="true">#</a> Task å¯¹è±¡</h3><p><code>class asyncio.Task(coro, *, loop=None, name=None)</code></p><p>ä¸€ä¸ªä¸ Â <code>[Future ç±»ä¼¼](https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future)</code>Â  çš„å¯¹è±¡ï¼Œå¯è¿è¡Œ PythonÂ <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#coroutine" target="_blank" rel="noopener noreferrer">åç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚éçº¿ç¨‹å®‰å…¨ã€‚</p><p>Task å¯¹è±¡è¢«ç”¨æ¥åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œåç¨‹ã€‚å¦‚æœä¸€ä¸ªåç¨‹åœ¨ç­‰å¾…ä¸€ä¸ª Future å¯¹è±¡ï¼ŒTask å¯¹è±¡ä¼šæŒ‚èµ·è¯¥åç¨‹çš„æ‰§è¡Œå¹¶ç­‰å¾…è¯¥ Future å¯¹è±¡å®Œæˆã€‚å½“è¯¥ Future å¯¹è±¡ Â <em>å®Œæˆ</em>ï¼Œè¢«æ‰“åŒ…çš„åç¨‹å°†æ¢å¤æ‰§è¡Œã€‚</p><p>äº‹ä»¶å¾ªç¯ä½¿ç”¨ååŒæ—¥ç¨‹è°ƒåº¦: ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ¯æ¬¡è¿è¡Œä¸€ä¸ª Task å¯¹è±¡ã€‚è€Œä¸€ä¸ª Task å¯¹è±¡ä¼šç­‰å¾…ä¸€ä¸ª Future å¯¹è±¡å®Œæˆï¼Œè¯¥äº‹ä»¶å¾ªç¯ä¼šè¿è¡Œå…¶ä»– Taskã€å›è°ƒæˆ–æ‰§è¡Œ IO æ“ä½œã€‚</p><p>ä½¿ç”¨é«˜å±‚çº§çš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.create_task" target="_blank" rel="noopener noreferrer">asyncio.create_task()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å‡½æ•°æ¥åˆ›å»º Task å¯¹è±¡ï¼Œä¹Ÿå¯ç”¨ä½å±‚çº§çš„ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_task" target="_blank" rel="noopener noreferrer">loop.create_task()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æˆ– Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.ensure_future" target="_blank" rel="noopener noreferrer">ensure_future()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å‡½æ•°ã€‚ä¸å»ºè®®æ‰‹åŠ¨å®ä¾‹åŒ– Task å¯¹è±¡ã€‚</p><p>è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Task å¯¹è±¡å¯ä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task.cancel" target="_blank" rel="noopener noreferrer">cancel()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•ã€‚è°ƒç”¨æ­¤æ–¹æ³•å°†ä½¿è¯¥ Task å¯¹è±¡æŠ›å‡ºä¸€ä¸ª Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.CancelledError" target="_blank" rel="noopener noreferrer">CancelledError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¼‚å¸¸ç»™æ‰“åŒ…çš„åç¨‹ã€‚å¦‚æœå–æ¶ˆæœŸé—´ä¸€ä¸ªåç¨‹æ­£åœ¨ç­‰å¾…ä¸€ä¸ª Future å¯¹è±¡ï¼Œè¯¥ Future å¯¹è±¡ä¹Ÿå°†è¢«å–æ¶ˆã€‚</p><p><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task.cancelled" target="_blank" rel="noopener noreferrer">cancelled()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¯è¢«ç”¨æ¥æ£€æµ‹ Task å¯¹è±¡æ˜¯å¦è¢«å–æ¶ˆã€‚å¦‚æœæ‰“åŒ…çš„åç¨‹æ²¡æœ‰æŠ‘åˆ¶ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-exceptions.html#asyncio.CancelledError" target="_blank" rel="noopener noreferrer">CancelledError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å¼‚å¸¸å¹¶ä¸”ç¡®å®è¢«å–æ¶ˆï¼Œè¯¥æ–¹æ³•å°†è¿”å› Â <code>True</code>ã€‚</p><p><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task" target="_blank" rel="noopener noreferrer">asyncio.Task<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ä» Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future" target="_blank" rel="noopener noreferrer">Future<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ç»§æ‰¿äº†å…¶é™¤ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future.set_result" target="_blank" rel="noopener noreferrer">Future.set_result()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å’Œ Â <a href="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future.set_exception" target="_blank" rel="noopener noreferrer">Future.set_exception()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ä»¥å¤–çš„æ‰€æœ‰ APIã€‚</p><p>Task å¯¹è±¡æ”¯æŒ Â <a href="https://docs.python.org/zh-cn/3/library/contextvars.html#module-contextvars" target="_blank" rel="noopener noreferrer">contextvars<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ¨¡å—ã€‚å½“ä¸€ä¸ª Task å¯¹è±¡è¢«åˆ›å»ºï¼Œå®ƒå°†å¤åˆ¶å½“å‰ä¸Šä¸‹æ–‡ï¼Œç„¶ååœ¨å¤åˆ¶çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå…¶åç¨‹ã€‚</p><ul><li>cancel(msg=None)ï¼šå–æ¶ˆä»»åŠ¡ï¼Œè¿™å°†æŠ›å‡º CancelledError</li><li>done()ï¼šå¦‚æœ Task å¯¹è±¡å·²å®Œæˆï¼Œåˆ™è¿”å› true</li><li>result()ï¼šè¿”å› Task çš„ç»“æœ</li><li>add_done_callback(callback, *, context=None)ï¼šæ·»åŠ ä¸€ä¸ªå›è°ƒï¼Œåœ¨ Task å®Œæˆæ—¶è°ƒç”¨ã€‚</li></ul><h2 id="stream-æµ" tabindex="-1"><a class="header-anchor" href="#stream-æµ" aria-hidden="true">#</a> Stream æµ <sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></h2><p>æµæ˜¯ç”¨äºå¤„ç†ç½‘ç»œè¿æ¥çš„æ”¯æŒ async/await çš„é«˜å±‚çº§åŸè¯­ã€‚ æµå…è®¸å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å›è°ƒæˆ–ä½çº§åè®®å’Œä¼ è¾“ã€‚</p><h3 id="stream-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#stream-å‡½æ•°" aria-hidden="true">#</a> Stream å‡½æ•°</h3><ul><li>open_connection</li><li>start_server</li></ul><h3 id="unix-å¥—æ¥å­—-socket" tabindex="-1"><a class="header-anchor" href="#unix-å¥—æ¥å­—-socket" aria-hidden="true">#</a> Unix å¥—æ¥å­—ï¼ˆSocketï¼‰</h3><ul><li>open_unix_connection</li><li>start_unix_server</li></ul><h3 id="streamreader-ä¸-streamwriter" tabindex="-1"><a class="header-anchor" href="#streamreader-ä¸-streamwriter" aria-hidden="true">#</a> StreamReader ä¸ StreamWriter</h3><h3 id="ä¾‹å­-echo-æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-echo-æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯" aria-hidden="true">#</a> ä¾‹å­ï¼šecho æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">handle_echo</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    addr <span class="token operator">=</span> writer<span class="token punctuation">.</span>get_extra_info<span class="token punctuation">(</span><span class="token string">&#39;peername&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Received </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token punctuation">{</span>addr<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Send: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">await</span> writer<span class="token punctuation">.</span>drain<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Close the connection&quot;</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    server <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>start_server<span class="token punctuation">(</span>
        handle_echo<span class="token punctuation">,</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>

    addrs <span class="token operator">=</span> <span class="token string">&#39;, &#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>sock<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> sock <span class="token keyword">in</span> server<span class="token punctuation">.</span>sockets<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;Serving on </span><span class="token interpolation"><span class="token punctuation">{</span>addrs<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> server<span class="token punctuation">:</span>
        <span class="token keyword">await</span> server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">tcp_echo_client</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    reader<span class="token punctuation">,</span> writer <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>open_connection<span class="token punctuation">(</span>
        <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;Send: </span><span class="token interpolation"><span class="token punctuation">{</span>message<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    data <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;Received: </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Close the connection&#39;</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tcp_echo_client<span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åŒæ­¥åŸè¯­" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥åŸè¯­" aria-hidden="true">#</a> åŒæ­¥åŸè¯­ <sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup></h2><p>asyncio åŒæ­¥åŸè¯­è¢«è®¾è®¡ä¸ºä¸ Â <a href="https://docs.python.org/zh-cn/3.10/library/threading.html#module-threading" target="_blank" rel="noopener noreferrer">threading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ¨¡å—çš„ç±»ä¼¼ï¼Œä½†æœ‰ä¸¤ä¸ªå…³é”®æ³¨æ„äº‹é¡¹:</p><ul><li>asyncio åŸè¯­ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å®ƒä»¬ä¸åº”è¢«ç”¨äº OS çº¿ç¨‹åŒæ­¥ (è€Œåº”å½“ä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/threading.html#module-threading" target="_blank" rel="noopener noreferrer">threading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)ï¼›</li><li>è¿™äº›åŒæ­¥åŸè¯­çš„æ–¹æ³•ä¸æ¥å— Â <em>timeout</em>Â  å‚æ•°ï¼›è¯·ä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio.wait_for" target="_blank" rel="noopener noreferrer">asyncio.wait_for()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å‡½æ•°æ¥æ‰§è¡Œå¸¦æœ‰è¶…æ—¶çš„æ“ä½œã€‚</li></ul><p>asyncio å…·æœ‰ä¸‹åˆ—åŸºæœ¬åŒæ­¥åŸè¯­:</p><h3 id="lock" tabindex="-1"><a class="header-anchor" href="#lock" aria-hidden="true">#</a> Lock</h3><p><code>class asyncio.Lock</code></p><p>å®ç°ä¸€ä¸ªç”¨äº asyncio ä»»åŠ¡çš„äº’æ–¥é”ã€‚ éçº¿ç¨‹å®‰å…¨ã€‚</p><p>asyncio é”å¯è¢«ç”¨æ¥ä¿è¯å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ã€‚</p><p>ä½¿ç”¨ Lock çš„æ¨èæ–¹å¼æ˜¯é€šè¿‡ Â <code>[async with](https://docs.python.org/zh-cn/3.10/reference/compound_stmts.html#async-with)</code>Â  è¯­å¥:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>lock <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ... later</span>
<span class="token keyword">async</span> <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
    <span class="token comment"># access shared state</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç­‰ä»·äºï¼š</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>lock <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ... later</span>
<span class="token keyword">await</span> lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># access shared state</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>coroutine acquire()</code></p><p>è·å–é”ã€‚ æ­¤æ–¹æ³•ä¼šç­‰å¾…ç›´è‡³é”ä¸º Â <em>unlocked</em>ï¼Œå°†å…¶è®¾ä¸º Â <em>locked</em>Â  å¹¶è¿”å› Â <code>True</code>ã€‚ å½“æœ‰ä¸€ä¸ªä»¥ä¸Šçš„åç¨‹åœ¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Lock.acquire" target="_blank" rel="noopener noreferrer">acquire()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ä¸­è¢«é˜»å¡åˆ™ä¼šç­‰å¾…è§£é”ï¼Œæœ€ç»ˆåªæœ‰ä¸€ä¸ªåç¨‹ä¼šè¢«æ‰§è¡Œã€‚ é”çš„è·å–æ˜¯ Â <em>å…¬å¹³çš„</em>: è¢«æ‰§è¡Œçš„åç¨‹å°†æ˜¯ç¬¬ä¸€ä¸ªå¼€å§‹ç­‰å¾…é”çš„åç¨‹ã€‚</p><p><code>release()</code></p><p>é‡Šæ”¾é”ã€‚</p><p>å½“é”ä¸º Â <em>locked</em>Â  æ—¶ï¼Œå°†å…¶è®¾ä¸º Â <em>unlocked</em>Â  å¹¶è¿”å›ã€‚</p><p>å¦‚æœé”ä¸º Â <em>unlocked</em>ï¼Œåˆ™ä¼šå¼•å‘ Â <a href="https://docs.python.org/zh-cn/3.10/library/exceptions.html#RuntimeError" target="_blank" rel="noopener noreferrer">RuntimeError<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p><code>locked()</code></p><p>å¦‚æœé”ä¸º Â <em>locked</em>Â  åˆ™è¿”å› Â <code>True</code>ã€‚</p><h3 id="event" tabindex="-1"><a class="header-anchor" href="#event" aria-hidden="true">#</a> Event</h3><p><code>class asyncio.Event</code></p><p>äº‹ä»¶å¯¹è±¡ã€‚ è¯¥å¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>asyncio äº‹ä»¶å¯è¢«ç”¨æ¥é€šçŸ¥å¤šä¸ª asyncio ä»»åŠ¡å·²ç»æœ‰äº‹ä»¶å‘ç”Ÿã€‚</p><p>Event å¯¹è±¡ä¼šç®¡ç†ä¸€ä¸ªå†…éƒ¨æ——æ ‡ï¼Œå¯é€šè¿‡ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.set" target="_blank" rel="noopener noreferrer">set()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•å°†å…¶è®¾ä¸º Â <em>true</em>Â  å¹¶é€šè¿‡ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.clear" target="_blank" rel="noopener noreferrer">clear()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•å°†å…¶é‡è®¾ä¸º Â <em>false</em>ã€‚Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.wait" target="_blank" rel="noopener noreferrer">wait()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•ä¼šé˜»å¡ç›´è‡³è¯¥æ——æ ‡è¢«è®¾ä¸º Â <em>true</em>ã€‚ è¯¥æ——æ ‡åˆå§‹æ—¶ä¼šè¢«è®¾ä¸º Â <em>false</em>ã€‚</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">waiter</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;waiting for it ...&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;... got it!&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Create an Event object.</span>
    event <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Spawn a Task to wait until &#39;event&#39; is set.</span>
    waiter_task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>waiter<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Sleep for 1 second and set the event.</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Wait until the waiter task is finished.</span>
    <span class="token keyword">await</span> waiter_task

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>coroutine wait()</code></p><p>ç­‰å¾…ç›´è‡³äº‹ä»¶è¢«è®¾ç½®ã€‚</p><p>å¦‚æœäº‹ä»¶å·²è¢«è®¾ç½®ï¼Œåˆ™ç«‹å³è¿”å› Â <code>True</code>ã€‚ å¦åˆ™å°†é˜»å¡ç›´è‡³å¦ä¸€ä¸ªä»»åŠ¡è°ƒç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.set" target="_blank" rel="noopener noreferrer">set()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p><code>set()</code></p><p>è®¾ç½®äº‹ä»¶ã€‚</p><p>æ‰€æœ‰ç­‰å¾…äº‹ä»¶è¢«è®¾ç½®çš„ä»»åŠ¡å°†è¢«ç«‹å³å”¤é†’ã€‚</p><p><code>clear()</code></p><p>æ¸…ç©ºï¼ˆå–æ¶ˆè®¾ç½®ï¼‰äº‹ä»¶ã€‚</p><p>é€šè¿‡ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.wait" target="_blank" rel="noopener noreferrer">wait()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  è¿›è¡Œç­‰å¾…çš„ä»»åŠ¡ç°åœ¨å°†ä¼šé˜»å¡ç›´è‡³ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#asyncio.Event.set" target="_blank" rel="noopener noreferrer">set()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•è¢«å†æ¬¡è°ƒç”¨ã€‚</p><p><code>is_set()</code></p><p>å¦‚æœäº‹ä»¶å·²è¢«è®¾ç½®åˆ™è¿”å› Â <code>True</code>ã€‚</p><h3 id="condition" tabindex="-1"><a class="header-anchor" href="#condition" aria-hidden="true">#</a> Condition</h3><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#condition" target="_blank" rel="noopener noreferrer">https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html#condition<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="semaphore" tabindex="-1"><a class="header-anchor" href="#semaphore" aria-hidden="true">#</a> Semaphore</h3><h3 id="boundedsemaphore" tabindex="-1"><a class="header-anchor" href="#boundedsemaphore" aria-hidden="true">#</a> BoundedSemaphore</h3><h2 id="é˜Ÿåˆ—é›†åˆ" tabindex="-1"><a class="header-anchor" href="#é˜Ÿåˆ—é›†åˆ" aria-hidden="true">#</a> é˜Ÿåˆ—é›†åˆ <sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup></h2><p>asyncio é˜Ÿåˆ—è¢«è®¾è®¡æˆä¸ Â <a href="https://docs.python.org/zh-cn/3.10/library/queue.html#module-queue" target="_blank" rel="noopener noreferrer">queue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ¨¡å—ç±»ä¼¼ã€‚å°½ç®¡ asyncio é˜Ÿåˆ—ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯è¢«è®¾è®¡ä¸“ç”¨äº async/await ä»£ç ã€‚</p><p>æ³¨æ„ asyncio çš„é˜Ÿåˆ—æ²¡æœ‰ Â <em>timeout</em>Â  å½¢å‚ï¼›è¯·ä½¿ç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio.wait_for" target="_blank" rel="noopener noreferrer">asyncio.wait_for()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å‡½æ•°ä¸ºé˜Ÿåˆ—æ·»åŠ è¶…æ—¶æ“ä½œã€‚</p><p>å‚è§ä¸‹é¢çš„ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#examples" target="_blank" rel="noopener noreferrer">Examples<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  éƒ¨åˆ†ã€‚</p><h3 id="queue" tabindex="-1"><a class="header-anchor" href="#queue" aria-hidden="true">#</a> Queue</h3><p><code>class asyncio.Queue(maxsize=0)</code></p><p>FIFO é˜Ÿåˆ—</p><p>å¦‚æœ Â <em>maxsize</em>Â  å°äºç­‰äºé›¶ï¼Œåˆ™é˜Ÿåˆ—å°ºå¯¸æ˜¯æ— é™çš„ã€‚å¦‚æœæ˜¯å¤§äº Â <code>0</code>Â  çš„æ•´æ•°ï¼Œåˆ™å½“é˜Ÿåˆ—è¾¾åˆ° Â <em>maxsize</em>Â  æ—¶ï¼ŒÂ <code>await put()</code>Â  å°†é˜»å¡è‡³æŸä¸ªå…ƒç´ è¢« Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio.Queue.get" target="_blank" rel="noopener noreferrer">get()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å–å‡ºã€‚</p><p>ä¸åƒæ ‡å‡†åº“ä¸­çš„å¹¶å‘å‹ Â <a href="https://docs.python.org/zh-cn/3.10/library/queue.html#module-queue" target="_blank" rel="noopener noreferrer">queue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â ï¼Œé˜Ÿåˆ—çš„å°ºå¯¸ä¸€ç›´æ˜¯å·²çŸ¥çš„ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio.Queue.qsize" target="_blank" rel="noopener noreferrer">qsize()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–¹æ³•è¿”å›ã€‚</p><ul><li>maxsize</li><li>empty()</li><li>full()</li><li>coroutine join()</li><li>get_nowait() ä¸é˜»å¡çš„å‡ºé˜Ÿ</li><li>coroutine join() é˜»å¡è‡³é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½è¢«æ¥æ”¶å’Œå¤„ç†å®Œæ¯•ã€‚ <ul><li>å½“æ¡ç›®æ·»åŠ åˆ°é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæœªå®Œæˆä»»åŠ¡çš„è®¡æ•°å°±ä¼šå¢åŠ ã€‚æ¯å½“æ¶ˆè´¹åç¨‹è°ƒç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio.Queue.task_done" target="_blank" rel="noopener noreferrer">task_done()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¡¨ç¤ºè¿™ä¸ªæ¡ç›®å·²ç»è¢«å›æ”¶ï¼Œè¯¥æ¡ç›®æ‰€æœ‰å·¥ä½œå·²ç»å®Œæˆï¼Œæœªå®Œæˆè®¡æ•°å°±ä¼šå‡å°‘ã€‚å½“æœªå®Œæˆè®¡æ•°é™åˆ°é›¶çš„æ—¶å€™ï¼ŒÂ <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio.Queue.join" target="_blank" rel="noopener noreferrer">join()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>é˜»å¡è¢«è§£é™¤ã€‚</li></ul></li><li>coroutine put(item)</li><li>put_nowait(item) ä¸é˜»å¡çš„å…¥é˜Ÿ</li><li>qsize()</li><li>task_done() è¡¨æ˜å‰é¢æ’é˜Ÿçš„ä»»åŠ¡å·²ç»å®Œæˆï¼Œå³ get å‡ºæ¥çš„å…ƒç´ ç›¸å…³æ“ä½œå·²ç»å®Œæˆã€‚</li></ul><h3 id="ä¼˜å…ˆçº§é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" aria-hidden="true">#</a> ä¼˜å…ˆçº§é˜Ÿåˆ—</h3><p><code>class asyncio.PriorityQueue</code></p><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio.Queue" target="_blank" rel="noopener noreferrer">Queue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  çš„å˜ä½“ï¼›æŒ‰ä¼˜å…ˆçº§é¡ºåºå–å‡ºæ¡ç›® (æœ€å°çš„å…ˆå–å‡º)ã€‚</p><p>æ¡ç›®é€šå¸¸æ˜¯ Â <code>(priority_number, data)</code>Â  å½¢å¼çš„å…ƒç»„ã€‚</p><h3 id="åè¿›å…ˆå‡ºé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#åè¿›å…ˆå‡ºé˜Ÿåˆ—" aria-hidden="true">#</a> <strong>åè¿›å…ˆå‡ºé˜Ÿåˆ—</strong></h3><p><code>class asyncio.LifoQueue</code></p><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­" aria-hidden="true">#</a> ä¾‹å­</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">worker</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># Get a &quot;work item&quot; out of the queue.</span>
        sleep_for <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Sleep for the &quot;sleep_for&quot; seconds.</span>
        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>sleep_for<span class="token punctuation">)</span>

        <span class="token comment"># Notify the queue that the &quot;work item&quot; has been processed.</span>
        queue<span class="token punctuation">.</span>task_done<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> has slept for </span><span class="token interpolation"><span class="token punctuation">{</span>sleep_for<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> seconds&#39;</span></span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Create a queue that we will use to store our &quot;workload&quot;.</span>
    queue <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Generate random timings and put them into the queue.</span>
    total_sleep_time <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sleep_for <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>
        total_sleep_time <span class="token operator">+=</span> sleep_for
        queue<span class="token punctuation">.</span>put_nowait<span class="token punctuation">(</span>sleep_for<span class="token punctuation">)</span>

    <span class="token comment"># Create three worker tasks to process the queue concurrently.</span>
    tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>worker<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;worker-</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">)</span>
        tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>task<span class="token punctuation">)</span>

    <span class="token comment"># Wait until the queue is fully processed.</span>
    started_at <span class="token operator">=</span> time<span class="token punctuation">.</span>monotonic<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> queue<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
    total_slept_for <span class="token operator">=</span> time<span class="token punctuation">.</span>monotonic<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> started_at

    <span class="token comment"># Cancel our worker tasks.</span>
    <span class="token keyword">for</span> task <span class="token keyword">in</span> tasks<span class="token punctuation">:</span>
        task<span class="token punctuation">.</span>cancel<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Wait until all worker tasks are cancelled.</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">,</span> return_exceptions<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;====&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;3 workers slept in parallel for </span><span class="token interpolation"><span class="token punctuation">{</span>total_slept_for<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> seconds&#39;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;total expected sleep time: </span><span class="token interpolation"><span class="token punctuation">{</span>total_sleep_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> seconds&#39;</span></span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº‹ä»¶å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶å¾ªç¯" aria-hidden="true">#</a> äº‹ä»¶å¾ªç¯ <sup class="footnote-ref"><a href="#footnote5">[5]</a><a class="footnote-anchor" id="footnote-ref5"></a></sup></h2><h3 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> <strong>å‰è¨€</strong></h3><p>äº‹ä»¶å¾ªç¯æ˜¯æ¯ä¸ª asyncio åº”ç”¨çš„æ ¸å¿ƒã€‚ äº‹ä»¶å¾ªç¯ä¼šè¿è¡Œå¼‚æ­¥ä»»åŠ¡å’Œå›è°ƒï¼Œæ‰§è¡Œç½‘ç»œ IO æ“ä½œï¼Œä»¥åŠè¿è¡Œå­è¿›ç¨‹ã€‚</p><p>åº”ç”¨å¼€å‘è€…é€šå¸¸åº”å½“ä½¿ç”¨é«˜å±‚çº§çš„ asyncio å‡½æ•°ï¼Œä¾‹å¦‚ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio.run" target="_blank" rel="noopener noreferrer">asyncio.run()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œåº”å½“å¾ˆå°‘æœ‰å¿…è¦å¼•ç”¨å¾ªç¯å¯¹è±¡æˆ–è°ƒç”¨å…¶æ–¹æ³•ã€‚ æœ¬èŠ‚æ‰€é’ˆå¯¹çš„ä¸»è¦æ˜¯ä½å±‚çº§ä»£ç ã€åº“å’Œæ¡†æ¶çš„ç¼–å†™è€…ï¼Œä»–ä»¬éœ€è¦æ›´ç»†è‡´åœ°æ§åˆ¶äº‹ä»¶å¾ªç¯è¡Œä¸ºã€‚</p><h2 id="é«˜å±‚çº§-api-ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#é«˜å±‚çº§-api-ç´¢å¼•" aria-hidden="true">#</a> é«˜å±‚çº§ API ç´¢å¼• <sup class="footnote-ref"><a href="#footnote6">[6]</a><a class="footnote-anchor" id="footnote-ref6"></a></sup></h2><p>è¿™ä¸ªé¡µé¢åˆ—ä¸¾äº†æ‰€æœ‰èƒ½ç”¨äº async/wait çš„é«˜å±‚çº§ asyncio API é›†ã€‚</p><h3 id="ä»»åŠ¡-1" tabindex="-1"><a class="header-anchor" href="#ä»»åŠ¡-1" aria-hidden="true">#</a> ä»»åŠ¡</h3><p>è¿è¡Œå¼‚æ­¥ç¨‹åºï¼Œåˆ›å»º Task å¯¹è±¡ï¼Œç­‰å¾…å¤šä»¶äº‹è¿è¡Œè¶…æ—¶çš„å…¬å…±é›†ã€‚</p><table><thead><tr><th>run()</th><th>åˆ›å»ºäº‹ä»¶å¾ªç¯ï¼Œè¿è¡Œä¸€ä¸ªåç¨‹ï¼Œå…³é—­äº‹ä»¶å¾ªç¯ã€‚</th></tr></thead><tbody><tr><td>create_task()</td><td>å¯åŠ¨ä¸€ä¸ª asyncio çš„ Task å¯¹è±¡ã€‚</td></tr><tr><td>awaitÂ sleep()</td><td>ä¼‘çœ å‡ ç§’ã€‚</td></tr><tr><td>awaitÂ gather()</td><td>å¹¶å‘æ‰§è¡Œæ‰€æœ‰äº‹ä»¶çš„è°ƒåº¦å’Œç­‰å¾…ã€‚</td></tr><tr><td>awaitÂ wait_for()</td><td>æœ‰è¶…æ—¶æ§åˆ¶çš„è¿è¡Œã€‚</td></tr><tr><td>awaitÂ shield()</td><td>å±è”½å–æ¶ˆæ“ä½œ</td></tr><tr><td>awaitÂ wait()</td><td>å®Œæˆæƒ…å†µçš„ç›‘æ§å™¨</td></tr><tr><td>current_task()</td><td>è¿”å›å½“å‰ Task å¯¹è±¡</td></tr><tr><td>all_tasks()</td><td>è¿”å›äº‹ä»¶å¾ªç¯ä¸­æ‰€æœ‰çš„ task å¯¹è±¡ã€‚</td></tr><tr><td>Task</td><td>Task å¯¹è±¡</td></tr><tr><td>to_thread()</td><td>åœ¨ä¸åŒçš„ OS çº¿ç¨‹ä¸­å¼‚æ­¥åœ°è¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚</td></tr><tr><td>run_coroutine_threadsafe()</td><td>ä»å…¶ä»– OS çº¿ç¨‹ä¸­è°ƒåº¦ä¸€ä¸ªåç¨‹ã€‚</td></tr><tr><td>forÂ inÂ as_completed()</td><td>ç”¨ Â forÂ  å¾ªç¯ç›‘æ§å®Œæˆæƒ…å†µã€‚</td></tr></tbody></table><p><strong>ä¾‹å­</strong></p><ul><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio-example-gather" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ asyncio.gather() å¹¶è¡Œè¿è¡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio-example-waitfor" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ asyncio.wait_for() å¼ºåˆ¶è¶…æ—¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio-example-task-cancel" target="_blank" rel="noopener noreferrer">æ’¤é”€åç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio-example-sleep" target="_blank" rel="noopener noreferrer">asyncio.sleep() çš„ç”¨æ³•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>è¯·ä¸»è¦å‚é˜… Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#coroutine" target="_blank" rel="noopener noreferrer">åç¨‹ä¸ä»»åŠ¡æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><h3 id="é˜Ÿåˆ—é›†" tabindex="-1"><a class="header-anchor" href="#é˜Ÿåˆ—é›†" aria-hidden="true">#</a> <strong>é˜Ÿåˆ—é›†</strong></h3><p>é˜Ÿåˆ—é›†è¢«ç”¨äºå¤šä¸ªå¼‚æ­¥ Task å¯¹è±¡çš„è¿è¡Œè°ƒåº¦ï¼Œå®ç°è¿æ¥æ± ä»¥åŠå‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€‚</p><table><thead><tr><th>Queue</th><th>å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</th></tr></thead><tbody><tr><td>PriorityQueue</td><td>ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</td></tr><tr><td>LifoQueue</td><td>åè¿›å…ˆå‡ºé˜Ÿåˆ—ã€‚</td></tr></tbody></table><p><strong>ä¾‹å­</strong></p><ul><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio-example-queue-dist" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ asyncio.Queue åœ¨å¤šä¸ªå¹¶å‘ä»»åŠ¡é—´åˆ†é…å·¥ä½œé‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>è¯·å‚é˜… Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html#asyncio-queues" target="_blank" rel="noopener noreferrer">é˜Ÿåˆ—é›†æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><h3 id="å­è¿›ç¨‹é›†" tabindex="-1"><a class="header-anchor" href="#å­è¿›ç¨‹é›†" aria-hidden="true">#</a> å­è¿›ç¨‹é›†</h3><p>ç”¨äºç”Ÿæˆå­è¿›ç¨‹å’Œè¿è¡Œ shell å‘½ä»¤çš„å·¥å…·åŒ…ã€‚</p><table><thead><tr><th>awaitÂ create_subprocess_exec()</th><th>åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚</th></tr></thead><tbody><tr><td>awaitÂ create_subprocess_shell()</td><td>è¿è¡Œä¸€ä¸ª shell å‘½ä»¤ã€‚</td></tr></tbody></table><p><strong>ä¾‹å­</strong></p><ul><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-subprocess.html#asyncio-example-subprocess-shell" target="_blank" rel="noopener noreferrer">æ‰§è¡Œä¸€ä¸ª shell å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>è¯·å‚é˜… Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-subprocess.html#asyncio-subprocess" target="_blank" rel="noopener noreferrer">å­è¿›ç¨‹ APIs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  ç›¸å…³æ–‡æ¡£.</li></ul><h3 id="æµ" tabindex="-1"><a class="header-anchor" href="#æµ" aria-hidden="true">#</a> æµ</h3><p>ç”¨äºç½‘ç»œ IO å¤„ç†çš„é«˜çº§ API é›†ã€‚</p><table><thead><tr><th>awaitÂ open_connection()</th><th>å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ã€‚</th></tr></thead><tbody><tr><td>awaitÂ open_unix_connection()</td><td>å»ºç«‹ä¸€ä¸ª Unix socket è¿æ¥ã€‚</td></tr><tr><td>awaitÂ start_server()</td><td>å¯åŠ¨ TCP æœåŠ¡ã€‚</td></tr><tr><td>awaitÂ start_unix_server()</td><td>å¯åŠ¨ä¸€ä¸ª Unix å¥—æ¥å­—æœåŠ¡ã€‚</td></tr><tr><td>StreamReader</td><td>æ¥æ”¶ç½‘ç»œæ•°æ®çš„é«˜çº§ async/await å¯¹è±¡ã€‚</td></tr><tr><td>StreamWriter</td><td>å‘é€ç½‘ç»œæ•°æ®çš„é«˜çº§ async/await å¯¹è±¡ã€‚</td></tr></tbody></table><p><strong>ä¾‹å­</strong></p><ul><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-stream.html#asyncio-example-stream" target="_blank" rel="noopener noreferrer">TCP å®¢æˆ·ç«¯æ ·ä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>è¯·å‚é˜… Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-stream.html#asyncio-streams" target="_blank" rel="noopener noreferrer">streams APIs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  æ–‡æ¡£ã€‚</li></ul><h3 id="åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥" aria-hidden="true">#</a> <strong>åŒæ­¥</strong></h3><p>èƒ½è¢«ç”¨äº Task å¯¹è±¡é›†çš„ï¼Œç±»ä¼¼çº¿ç¨‹çš„åŒæ­¥åŸºå…ƒç»„ä»¶ã€‚</p><table><thead><tr><th>Lock</th><th>äº’æ–¥é”ã€‚</th></tr></thead><tbody><tr><td>Event</td><td>äº‹ä»¶å¯¹è±¡ã€‚</td></tr><tr><td>Condition</td><td>æ¡ä»¶å¯¹è±¡</td></tr><tr><td>Semaphore</td><td>ä¿¡å·é‡</td></tr><tr><td>BoundedSemaphore</td><td>æœ‰ç•Œçš„ä¿¡å·é‡ã€‚</td></tr></tbody></table><h3 id="å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#å¼‚å¸¸" aria-hidden="true">#</a> <strong>å¼‚å¸¸</strong></h3><table><thead><tr><th>asyncio.TimeoutError</th><th>ç±»ä¼¼ Â wait_for()Â  ç­‰å‡½æ•°åœ¨è¶…æ—¶æ—¶å€™è¢«å¼•å‘ã€‚è¯·æ³¨æ„ Â asyncio.TimeoutErrorÂ  ä¸å†…å»ºå¼‚å¸¸ Â TimeoutErrorÂ  æ— å…³ã€‚</th></tr></thead><tbody><tr><td>asyncio.CancelledError</td><td>å½“ä¸€ä¸ª Task å¯¹è±¡è¢«å–æ¶ˆçš„æ—¶å€™è¢«å¼•å‘ã€‚è¯·å‚é˜… Â Task.cancel()ã€‚</td></tr></tbody></table><p><strong>ä¾‹å­</strong></p><ul><li><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio-example-task-cancel" target="_blank" rel="noopener noreferrer">åœ¨å–æ¶ˆè¯·æ±‚å‘ç”Ÿçš„è¿è¡Œä»£ç ä¸­å¦‚ä½•å¤„ç† CancelledError å¼‚å¸¸<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>è¯·å‚é˜…å®Œæ•´çš„ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-exceptions.html#asyncio-exceptions" target="_blank" rel="noopener noreferrer">asyncio ä¸“ç”¨å¼‚å¸¸<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  åˆ—è¡¨.</li></ul><h2 id="å…³äº-never-awaited-åç¨‹" tabindex="-1"><a class="header-anchor" href="#å…³äº-never-awaited-åç¨‹" aria-hidden="true">#</a> å…³äº never-awaited åç¨‹</h2><p>å½“åç¨‹å‡½æ•°è¢«è°ƒç”¨è€Œä¸æ˜¯è¢«ç­‰å¾…æ—¶ (å³æ‰§è¡Œ Â <code>coro()</code>Â  è€Œä¸æ˜¯ Â <code>await coro()</code>) æˆ–è€…åç¨‹æ²¡æœ‰é€šè¿‡ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio.create_task" target="_blank" rel="noopener noreferrer">asyncio.create_task()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  è¢«æ’å…¥è®¡åˆ’æ—¥ç¨‹ï¼Œasyncio å°†ä¼šå‘å‡ºä¸€æ¡ Â <a href="https://docs.python.org/zh-cn/3.10/library/exceptions.html#RuntimeWarning" target="_blank" rel="noopener noreferrer">RuntimeWarning<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;never scheduled&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    test<span class="token punctuation">(</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># test.py:7: RuntimeWarning: coroutine &#39;test&#39; was never awaited</span>
<span class="token comment">#  test()</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸çš„ä¿®å¤æ–¹æ³•æ˜¯ <code>await</code> åç¨‹æˆ–è€…è°ƒç”¨ Â <a href="https://docs.python.org/zh-cn/3.10/library/asyncio-task.html#asyncio.create_task" target="_blank" rel="noopener noreferrer">asyncio.create_task()<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>Â  å‡½æ•°:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># å¼€å§‹è¿è¡Œå¹¶ç­‰å¾…å®Œæˆ</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># å¼€å§‹è¿è¡Œ</span>
        <span class="token keyword">await</span> task  <span class="token comment"># ç­‰å¾…å®Œæˆ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html" target="_blank" rel="noopener noreferrer">åç¨‹ä¸ä»»åŠ¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref1" class="footnote-backref">â†©ï¸</a></p></li><li id="footnote2" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-stream.html" target="_blank" rel="noopener noreferrer">Stream æµ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref2" class="footnote-backref">â†©ï¸</a></p></li><li id="footnote3" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-sync.html" target="_blank" rel="noopener noreferrer">åŒæ­¥åŸè¯­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref3" class="footnote-backref">â†©ï¸</a></p></li><li id="footnote4" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-queue.html" target="_blank" rel="noopener noreferrer">é˜Ÿåˆ—é›†åˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref4" class="footnote-backref">â†©ï¸</a></p></li><li id="footnote5" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-eventloop.html" target="_blank" rel="noopener noreferrer">äº‹ä»¶å¾ªç¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref5" class="footnote-backref">â†©ï¸</a></p></li><li id="footnote6" class="footnote-item"><p><a href="https://docs.python.org/zh-cn/3.10/library/asyncio-api-index.html" target="_blank" rel="noopener noreferrer">é«˜å±‚çº§ API ç´¢å¼•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="#footnote-ref6" class="footnote-backref">â†©ï¸</a></p></li></ol></section></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/timpcfan/timpcfan.github.io/edit/main/docs/code/language/python/python-asyncio.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/10/2 16:52:25</span></div><!----></footer><nav class="page-nav"><a href="/code/language/python/python-concurrent.html" class="nav-link prev" aria-label="Pythonå¹¶å‘ç¼–ç¨‹"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Pythonå¹¶å‘ç¼–ç¨‹</div></a><!----></nav><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline" pageview="true"><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariahidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewbox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="é¢„è§ˆ"><svg viewbox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button class="wl-btn">ç™»å½•</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-count"><!--v-if--> è¯„è®º</div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewbox="0 0 100 100" preserveaspectratio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokewidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributename="transform" type="rotate" repeatcount="indefinite" dur="1s" values="0 50 50;360 50 50" keytimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noreferrer"> Waline </a> v2.6.3</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">æœ¬ç«™åŸåˆ›å†…å®¹åŸºäº <a class="underline" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> å…±äº«, è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</div><div class="copyright">Copyright Â© 2022 TrystanLei</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.905a1b95.js" defer></script>
  </body>
</html>
